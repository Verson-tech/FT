<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Family Tree</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 50%,
          #f093fb 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        display: flex;
        gap: 20px;
      }

      .main-content {
        flex: 1;
      }

      .timeline-panel {
        width: 150px;
        background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        border-radius: 25px;
        padding: 20px;
        box-shadow: 0 1px 1px 0 rgba(0, 28, 36, 0.3);
        border: 1px solid #eaeded;
      }

      .timeline-container {
        position: relative;
        height: 600px;
        background: linear-gradient(45deg, #a8e6cf 0%, #dcedc1 100%);
        border-radius: 25px;
        padding: 15px 15px 15px 60px;
        border: 1px solid #eaeded;
      }

      .timeline-axis {
        position: absolute;
        left: 50px;
        top: 15px;
        bottom: 15px;
        width: 2px;
        background: #ec7211;
      }

      .timeline-year-label {
        position: absolute;
        left: 15px;
        font-size: 0.75em;
        color: #545b64;
        font-weight: 700;
        width: 30px;
      }

      .timeline-person {
        position: absolute;
        left: 65px;
        right: 15px;
        background: #ec7211;
        border-radius: 25px;
        padding: 5px 8px;
        color: white;
        font-size: 0.7em;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        opacity: 0.3;
        border: 1px solid #dd6b10;
      }

      .timeline-person:hover,
      .timeline-person.highlighted {
        opacity: 1;
      }

      .timeline-person:hover {
        transform: translateX(3px);
        box-shadow: 0 2px 4px 0 rgba(0, 28, 36, 0.5);
        z-index: 10;
      }

      .timeline-person.highlighted {
        box-shadow: 0 0 0 2px #232f3e;
        z-index: 10;
      }

      .timeline-person.deceased {
        background: #545b64;
        border: 1px solid #414750;
      }

      .timeline-dates {
        font-size: 0.65em;
        opacity: 0.9;
      }

      h1 {
        text-align: center;
        color: #232f3e;
        margin-bottom: 10px;
        font-size: 2em;
        font-weight: 300;
        background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        padding: 15px;
        border-radius: 25px;
      }

      .legend {
        text-align: center;
        margin-bottom: 30px;
        padding: 15px;
        background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        border-radius: 25px;
        border: 1px solid #eaeded;
      }

      .legend-item {
        display: inline-block;
        margin: 0 15px;
        font-size: 0.9em;
      }

      .legend-line {
        display: inline-block;
        width: 30px;
        height: 2px;
        vertical-align: middle;
        margin-right: 5px;
      }

      .blood-line {
        background: #ec7211;
      }

      .marriage-line {
        background: #545b64;
        border-top: 2px dashed #545b64;
        height: 0;
      }

      .tree-container {
        position: relative;
        overflow-x: auto;
        padding: 40px 20px 40px 140px;
      }

      .generation-row {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        margin-bottom: 100px;
        position: relative;
        gap: 80px;
      }

      .generation-label {
        position: absolute;
        left: -120px;
        top: 20px;
        font-weight: 700;
        color: #232f3e;
        font-size: 0.85em;
        background: linear-gradient(332deg, #2a6a34 0%, #fed6f6 100%);
        padding: 5px 10px;
        border-radius: 25px;
        white-space: nowrap;
        border: 1px solid #eaeded;
      }

      .person-card {
        background: white;
        border: 2px solid #667eea;
        border-radius: 50%;
        padding: 4px;
        width: 35px !important;
        min-width: 35px;
        max-width: 35px;
        height: 42px;
        text-align: center;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        box-sizing: border-box;
      }

      .person-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        border-color: #764ba2;
      }

      .person-card.spouse {
        border-style: dashed;
        border-color: #e74c3c;
      }

      .person-card.female {
        background: #ffe5f1;
        border-color: #d13212;
      }

      .person-card.male {
        background: #e7f5ff;
        border-color: #0972d3;
      }

      .gender-icon {
        font-size: 0.5em;
        margin-bottom: 1px;
      }

      .person-name {
        font-size: 0.5em;
        font-weight: bold;
        color: #333;
        margin-bottom: 1px;
      }

      .person-role {
        font-size: 0.3em;
        color: #666;
        font-style: italic;
      }

      .couple-group {
        display: flex;
        gap: 25px;
        align-items: center;
        position: relative;
        padding: 10px;
        background: linear-gradient(45deg, #c39bd3 0%, #e8daef 100%);
        border-radius: 50px;
        border: 3px solid #8e44ad;
      }

      .sibling-group {
        display: flex;
        gap: 15px;
        align-items: center;
        padding: 10px;
        background: linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%);
        border-radius: 50px;
        border: 1px solid #ec7211;
      }

      .marriage-connector {
        position: absolute;
        height: 2px;
        background: #545b64;
        top: 50%;
        left: 0;
        right: 0;
        z-index: -1;
      }

      svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
      }

      .search-container {
        text-align: center;
        margin-bottom: 20px;
      }

      .search-input {
        padding: 8px 12px;
        border: 1px solid #aab7b8;
        border-radius: 25px;
        width: 300px;
        font-size: 0.9em;
        outline: none;
        font-family: "Amazon Ember", "Helvetica Neue", Roboto, Arial, sans-serif;
        background: linear-gradient(45deg, #a8e6cf 0%, #dcedc1 100%);
      }

      .search-input:focus {
        border-color: #ec7211;
        box-shadow: 0 0 0 2px rgba(236, 114, 17, 0.2);
      }

      .male-text {
        color: blue;
      }

      .female-text {
        color: #d63384;
        font-weight: bold;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        h1 {
          font-size: 1.8em;
        }

        .person-card {
          width: 90px;
        }

        .generation-label {
          position: static;
          margin-bottom: 10px;
        }

        .legend-item {
          display: block;
          margin: 5px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-content">
        <h1>üå≥ Family Tree</h1>

        <div class="legend">
          <div class="legend-item">
            <span class="male-text">üë® Male</span>
          </div>
          <div class="legend-item">
            <span class="female-text">üë© Female</span>
          </div>
        </div>

        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Search family member..."
            id="searchInput"
          />
        </div>

        <div class="tree-container" id="treeContainer">
          <svg id="connectionLines"></svg>
          <!-- Tree will be generated here -->
        </div>
      </div>

      <div class="timeline-panel">
        <div class="timeline-container" id="timelineContainer">
          <div class="timeline-axis"></div>
        </div>
      </div>
    </div>

    <script>
      // Family data structure
      const familyData = [
        // Generation 3 (Current - Children)
        {
          id: 1,
          name: "1",
          fullName: "John Michael Smith",
          gender: "female",
          generation: 3,
          spouse: 2,
          parents: [4, 5],
          siblings: [3],
          bloodRelative: true,
          birthDate: "1980-05-15",
          deathDate: null,
        },
        {
          id: 2,
          name: "2",
          fullName: "Sarah Jane Doe",
          gender: "male",
          generation: 3,
          spouse: 1,
          marriedIn: true,
          birthDate: "1978-08-22",
          deathDate: null,
        },
        {
          id: 3,
          name: "3",
          fullName: "Robert James Smith",
          gender: "male",
          generation: 3,
          parents: [4, 5],
          siblings: [1],
          bloodRelative: true,
          birthDate: "1982-11-30",
          deathDate: null,
        },
        {
          id: 7,
          name: "7",
          gender: "male",
          generation: 3,
          parents: [6, 2.2],
          siblings: [8],
          bloodRelative: true,
          birthDate: "1985-03-12",
          deathDate: null,
        },
        {
          id: 8,
          name: "8",
          gender: "male",
          generation: 3,
          parents: [6, 2.2],
          siblings: [7],
          bloodRelative: true,
          birthDate: "1987-07-04",
          deathDate: null,
        },
        {
          id: 17,
          name: "17",
          gender: "male",
          generation: 3,
          parents: [16],
          siblings: [18, 19, 20],
          bloodRelative: true,
          birthDate: "1990-02-14",
          deathDate: null,
        },
        {
          id: 18,
          name: "18",
          fullName: "Emily Rose Wilson",
          gender: "female",
          generation: 3,
          parents: [16],
          siblings: [17, 19, 20],
          bloodRelative: true,
          birthDate: "1992-09-20",
          deathDate: null,
        },
        {
          id: 19,
          name: "19",
          fullName: "Michael David Wilson",
          gender: "male",
          generation: 3,
          parents: [16],
          siblings: [17, 18, 20],
          bloodRelative: true,
          birthDate: "1994-03-15",
          deathDate: null,
        },
        {
          id: 20,
          name: "20",
          fullName: "Jessica Marie Wilson",
          gender: "female",
          generation: 3,
          parents: [16],
          siblings: [17, 18, 19],
          bloodRelative: true,
          birthDate: "1996-07-08",
          deathDate: null,
        },

        // Generation 2 (Parents)
        {
          id: 4,
          name: "4",
          fullName: "Mary Elizabeth Brown",
          gender: "female",
          generation: 2,
          spouse: 5,
          children: [1, 3],
          parents: [14, 15],
          siblings: [16],
          bloodRelative: true,
          birthDate: "1955-04-10",
          deathDate: null,
        },
        {
          id: 5,
          name: "5",
          gender: "male",
          generation: 2,
          spouse: 4,
          children: [1, 3],
          parents: [9, 10],
          siblings: [6],
          bloodRelative: true,
          birthDate: "1953-12-25",
          deathDate: "2010-06-15",
        },
        {
          id: 6,
          name: "6",
          gender: "female",
          generation: 2,
          spouse: 2.2,
          children: [7, 8],
          parents: [9, 10],
          siblings: [5],
          bloodRelative: true,
          birthDate: "1958-06-18",
          deathDate: null,
        },
        {
          id: 2.2,
          name: "2.2",
          gender: "male",
          generation: 2,
          spouse: 6,
          children: [7, 8],
          marriedIn: true,
          birthDate: "1956-03-30",
          deathDate: "2015-11-20",
        },
        {
          id: 16,
          name: "16",
          gender: "male",
          generation: 2,
          parents: [14, 15],
          siblings: [4],
          children: [17, 18, 19, 20],
          bloodRelative: true,
          birthDate: "1960-01-08",
          deathDate: null,
        },

        // Generation 1 (Grandparents)
        {
          id: 9,
          name: "9",
          gender: "male",
          generation: 1,
          spouse: 10,
          children: [5, 6],
          siblings: [12, 13],
          bloodRelative: true,
          birthDate: "1925-08-15",
          deathDate: "2005-03-22",
        },
        {
          id: 10,
          name: "10",
          gender: "female",
          generation: 1,
          spouse: 9,
          children: [5, 6],
          siblings: [11],
          bloodRelative: true,
          birthDate: "1919-10-29",
          deathDate: "1997-01-07",
        },
        {
          id: 11,
          name: "11",
          gender: "female",
          generation: 1,
          siblings: [10],
          bloodRelative: true,
          birthDate: "1922-05-12",
          deathDate: "2008-09-30",
        },
        {
          id: 12,
          name: "12",
          gender: "male",
          generation: 1,
          siblings: [9, 13],
          bloodRelative: true,
          birthDate: "1920-03-05",
          deathDate: "1995-12-14",
        },
        {
          id: 13,
          name: "13",
          gender: "female",
          generation: 1,
          siblings: [9, 12],
          bloodRelative: true,
          birthDate: "1928-07-22",
          deathDate: "2012-04-18",
        },
        {
          id: 14,
          name: "14",
          gender: "male",
          generation: 1,
          spouse: 15,
          children: [4, 16],
          bloodRelative: true,
          birthDate: "1930-11-03",
          deathDate: "2018-08-25",
        },
        {
          id: 15,
          name: "15",
          gender: "female",
          generation: 1,
          spouse: 14,
          children: [4, 16],
          bloodRelative: true,
          birthDate: "1932-02-17",
          deathDate: "2020-05-10",
        },
      ];

      function createPersonCard(person) {
        const card = document.createElement("div");
        card.className = `person-card ${person.gender} ${
          person.marriedIn ? "spouse" : ""
        }`;
        card.dataset.id = person.id;
        card.id = `person-${person.id}`;

        const genderIcon = person.gender === "male" ? "üë®" : "üë©";
        const role = person.marriedIn ? "(Spouse)" : "";

        card.innerHTML = `
                <div class="gender-icon">${genderIcon}</div>
                <div class="person-name">${person.name}</div>
                <div class="person-role">${role}</div>
                <div class="tooltip" style="display:none; position:absolute; background:#333; color:white; padding:5px; border-radius:3px; font-size:12px; z-index:1000; top:-30px; left:50%; transform:translateX(-50%); white-space:nowrap;">${person.fullName || person.name}</div>
            `;
            
            // Add instant hover tooltip
            card.addEventListener('mouseenter', () => {
                const tooltip = card.querySelector('.tooltip');
                if (tooltip) tooltip.style.display = 'block';
            });
            
            card.addEventListener('mouseleave', () => {
                const tooltip = card.querySelector('.tooltip');
                if (tooltip) tooltip.style.display = 'none';
            });

        card.addEventListener("click", () => openBioPage(person));

        // Add hover effect to highlight in timeline
        card.addEventListener("mouseenter", () => {
          highlightTimeline(person.id);
        });

        card.addEventListener("mouseleave", () => {
          clearTimelineHighlight();
        });

        return card;
      }

      function openBioPage(person) {
        const spouse = familyData.find((p) => p.id === person.spouse);
        const parents = familyData.filter(
          (p) => person.parents && person.parents.includes(p.id)
        );
        const children = familyData.filter(
          (p) => p.parents && p.parents.includes(person.id)
        );
        const siblings = familyData.filter(
          (p) => person.siblings && person.siblings.includes(p.id)
        );

        const birthDateStr = new Date(person.birthDate).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "short", day: "numeric" }
        );
        const deathDateStr = person.deathDate
          ? new Date(person.deathDate).toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "numeric",
            })
          : "Living";

        let bioHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${person.name} - Biography</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            padding: 40px;
                            margin: 0;
                        }
                        .bio-container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                            border-radius: 20px;
                            padding: 40px;
                            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        }
                        h1 {
                            color: #333;
                            border-bottom: 3px solid #667eea;
                            padding-bottom: 15px;
                        }
                        .gender-icon {
                            font-size: 3em;
                            text-align: center;
                            margin: 20px 0;
                        }
                        .section {
                            margin: 30px 0;
                        }
                        .section-title {
                            color: #667eea;
                            font-size: 1.5em;
                            margin-bottom: 15px;
                            font-weight: bold;
                        }
                        .family-links {
                            display: flex;
                            flex-wrap: wrap;
                            gap: 10px;
                        }
                        .family-link {
                            background: #f8f9fa;
                            border: 2px solid #667eea;
                            border-radius: 10px;
                            padding: 10px 20px;
                            text-decoration: none;
                            color: #333;
                            transition: all 0.3s ease;
                            cursor: pointer;
                        }
                        .family-link:hover {
                            background: #667eea;
                            color: white;
                            transform: translateY(-2px);
                        }
                        .back-button {
                            display: inline-block;
                            background: #667eea;
                            color: white;
                            padding: 12px 30px;
                            border-radius: 25px;
                            text-decoration: none;
                            margin-top: 30px;
                            transition: all 0.3s ease;
                            cursor: pointer;
                        }
                        .back-button:hover {
                            background: #764ba2;
                            transform: translateY(-2px);
                        }
                        .info-badge {
                            display: inline-block;
                            background: #e74c3c;
                            color: white;
                            padding: 5px 15px;
                            border-radius: 15px;
                            font-size: 0.9em;
                            margin-top: 10px;
                        }
                        .life-dates {
                            color: #666;
                            font-size: 1.1em;
                            margin: 10px 0;
                        }
                    </style>
                </head>
                <body>
                    <div class="bio-container">
                        <div class="gender-icon">${
                          person.gender === "male" ? "üë®" : "üë©"
                        }</div>
                        <h1>${person.name}</h1>
                        ${
                          person.marriedIn
                            ? '<div class="info-badge">Married Into Family</div>'
                            : ""
                        }
                        <div class="life-dates">Born: ${birthDateStr}${
          person.deathDate ? "<br>Died: " + deathDateStr : "<br>Status: Living"
        }</div>
                        
                        <div class="section">
                            <div class="section-title">Biography</div>
                            <p>This is where the biography and life story of ${
                              person.name
                            } would be displayed. You can add birth dates, death dates, life achievements, stories, photos, and any other relevant information.</p>
                        </div>
            `;

        if (spouse) {
          bioHTML += `
                    <div class="section">
                        <div class="section-title">Spouse</div>
                        <div class="family-links">
                            <span class="family-link" onclick="if(window.opener && !window.opener.closed){window.opener.focusPerson(${spouse.id});}">${spouse.name}</span>
                        </div>
                    </div>
                `;
        }

        if (parents.length > 0) {
          bioHTML += `
                    <div class="section">
                        <div class="section-title">Parents</div>
                        <div class="family-links">
                            ${parents
                              .map(
                                (p) =>
                                  `<span class="family-link" onclick="if(window.opener && !window.opener.closed){window.opener.focusPerson(${p.id});}">${p.name}</span>`
                              )
                              .join("")}
                        </div>
                    </div>
                `;
        }

        if (children.length > 0) {
          bioHTML += `
                    <div class="section">
                        <div class="section-title">Children</div>
                        <div class="family-links">
                            ${children
                              .map(
                                (p) =>
                                  `<span class="family-link" onclick="if(window.opener && !window.opener.closed){window.opener.focusPerson(${p.id});}">${p.name}</span>`
                              )
                              .join("")}
                        </div>
                    </div>
                `;
        }

        if (siblings.length > 0) {
          bioHTML += `
                    <div class="section">
                        <div class="section-title">Siblings</div>
                        <div class="family-links">
                            ${siblings
                              .map(
                                (p) =>
                                  `<span class="family-link" onclick="if(window.opener && !window.opener.closed){window.opener.focusPerson(${p.id});}">${p.name}</span>`
                              )
                              .join("")}
                        </div>
                    </div>
                `;
        }

        bioHTML += `
                        <a href="javascript:window.close()" class="back-button">‚Üê Close</a>
                    </div>
                </body>
                </html>
            `;

        const bioWindow = window.open("", "_blank");
        if (bioWindow) {
          bioWindow.document.write(bioHTML);
          bioWindow.document.close();
        }
      }

      function focusPerson(personId) {
        const card = document.querySelector(`[data-id="${personId}"]`);
        if (card) {
          card.scrollIntoView({ behavior: "smooth", block: "center" });
          card.style.animation = "pulse 1s ease-in-out";
          card.style.animation = "";
        }
      }

      function renderTimeline() {
        const container = document.getElementById("timelineContainer");

        // Calculate date range
        const currentYear = new Date().getFullYear();
        const allBirthYears = familyData.map((p) =>
          new Date(p.birthDate).getFullYear()
        );
        const oldestYear = Math.min(...allBirthYears);
        const timelineHeight = 600;
        const yearRange = currentYear - oldestYear;
        const pixelsPerYear = timelineHeight / yearRange;

        // Add year labels every 20 years (from bottom to top: old to new)
        for (let year = oldestYear; year <= currentYear; year += 20) {
          const label = document.createElement("div");
          label.className = "timeline-year-label";
          label.textContent = year;
          // Invert position: older years at bottom
          const position = timelineHeight - (year - oldestYear) * pixelsPerYear;
          label.style.top = position + "px";
          container.appendChild(label);
        }

        // Add current year label at top
        const currentLabel = document.createElement("div");
        currentLabel.className = "timeline-year-label";
        currentLabel.textContent = currentYear;
        currentLabel.style.top = "0px";
        currentLabel.style.fontWeight = "bold";
        currentLabel.style.color = "#667eea";
        container.appendChild(currentLabel);

        // Sort people by birth year
        const sortedPeople = [...familyData].sort(
          (a, b) =>
            new Date(a.birthDate).getTime() - new Date(b.birthDate).getTime()
        );

        // Render each person's lifespan
        sortedPeople.forEach((person) => {
          const birthYear = new Date(person.birthDate).getFullYear();
          const deathYear = person.deathDate
            ? new Date(person.deathDate).getFullYear()
            : currentYear;

          // Invert positions: birth at bottom, death/current at top
          const birthPos =
            timelineHeight - (birthYear - oldestYear) * pixelsPerYear;
          const deathPos =
            timelineHeight - (deathYear - oldestYear) * pixelsPerYear;
          const height = birthPos - deathPos;

          const personBar = document.createElement("div");
          personBar.className = `timeline-person ${
            person.deathDate ? "deceased" : ""
          }`;
          personBar.dataset.personId = person.id;
          personBar.style.top = deathPos + "px";
          personBar.style.height = height + "px";

          const birthDateStr = new Date(person.birthDate).toLocaleDateString(
            "en-US",
            { year: "numeric", month: "short", day: "numeric" }
          );
          const deathDateStr = person.deathDate
            ? new Date(person.deathDate).toLocaleDateString("en-US", {
                year: "numeric",
                month: "short",
                day: "numeric",
              })
            : "Present";

          personBar.innerHTML = `
                    <span>${person.name}</span>
                    <span class="timeline-dates">${birthYear}-${
            deathYear === currentYear && !person.deathDate ? "Now" : deathYear
          }</span>
                `;

          personBar.addEventListener("click", () => {
            focusPerson(person.id);
          });

          container.appendChild(personBar);
        });
      }

      function highlightTimeline(personId) {
        // Remove all previous highlights
        clearTimelineHighlight();

        // Highlight the timeline bar for this person
        const timelineBar = document.querySelector(
          `.timeline-person[data-person-id="${personId}"]`
        );
        if (timelineBar) {
          timelineBar.classList.add("highlighted");
        }
      }

      function clearTimelineHighlight() {
        const highlighted = document.querySelectorAll(
          ".timeline-person.highlighted"
        );
        highlighted.forEach((el) => el.classList.remove("highlighted"));
      }

      window.focusPerson = focusPerson;

      function drawConnections() {
        const svg = document.getElementById("connectionLines");
        svg.innerHTML = "";

        familyData.forEach((person) => {
          if (person.parents && person.parents.length > 0) {
            const childCard = document.getElementById(`person-${person.id}`);
            if (!childCard) return;

            const childRect = childCard.getBoundingClientRect();
            const containerRect = document
              .getElementById("treeContainer")
              .getBoundingClientRect();

            const childX =
              childRect.left + childRect.width / 2 - containerRect.left;
            const childY = childRect.top - containerRect.top;

            // Find parents
            person.parents.forEach((parentId) => {
              const parentCard = document.getElementById(`person-${parentId}`);
              if (parentCard) {
                const parentRect = parentCard.getBoundingClientRect();
                const parentX =
                  parentRect.left + parentRect.width / 2 - containerRect.left;
                const parentY = parentRect.bottom - containerRect.top;

                // Draw line
                const line = document.createElementNS(
                  "http://www.w3.org/2000/svg",
                  "line"
                );
                line.setAttribute("x1", childX);
                line.setAttribute("y1", childY);
                line.setAttribute("x2", parentX);
                line.setAttribute("y2", parentY);
                line.setAttribute("stroke", "#ec7211");
                line.setAttribute("stroke-width", "2");
                svg.appendChild(line);
              }
            });
          }
        });
      }

      function renderTree() {
        const container = document.getElementById("treeContainer");
        const svgElement = container.querySelector("svg");
        container.innerHTML = "";
        container.appendChild(svgElement);

        // Generation 3 (Top row)
        const gen3Row = document.createElement("div");
        gen3Row.className = "generation-row";
        gen3Row.innerHTML = '<div class="generation-label">Gen A</div>';

        // Sibling group 1: Children of 4 & 5
        const siblingGroup1 = document.createElement("div");
        siblingGroup1.className = "sibling-group";

        // 1 & 2 (couple)
        const couple1 = document.createElement("div");
        couple1.className = "couple-group";
        couple1.appendChild(
          createPersonCard(familyData.find((p) => p.id === 1))
        );
        couple1.appendChild(
          createPersonCard(familyData.find((p) => p.id === 2))
        );
        const connector1 = document.createElement("div");
        connector1.className = "marriage-connector";
        couple1.appendChild(connector1);
        siblingGroup1.appendChild(couple1);

        // 3 (single)
        siblingGroup1.appendChild(
          createPersonCard(familyData.find((p) => p.id === 3))
        );
        gen3Row.appendChild(siblingGroup1);

        // Sibling group 2: Children of 16
        const siblingGroup2 = document.createElement("div");
        siblingGroup2.className = "sibling-group";

        // 17 (single - son of 16)
        siblingGroup2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 17))
        );

        // 18 (single - daughter of 16)
        siblingGroup2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 18))
        );

        // 19 (single - son of 16)
        siblingGroup2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 19))
        );

        // 20 (single - daughter of 16)
        siblingGroup2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 20))
        );
        gen3Row.appendChild(siblingGroup2);

        // Sibling group 3: Children of 6 & 2.2
        const siblingGroup3 = document.createElement("div");
        siblingGroup3.className = "sibling-group";

        // 7 (single)
        siblingGroup3.appendChild(
          createPersonCard(familyData.find((p) => p.id === 7))
        );

        // 8 (single)
        siblingGroup3.appendChild(
          createPersonCard(familyData.find((p) => p.id === 8))
        );
        gen3Row.appendChild(siblingGroup3);

        container.appendChild(gen3Row);

        // Generation 2 (Middle row)
        const gen2Row = document.createElement("div");
        gen2Row.className = "generation-row";
        gen2Row.innerHTML = '<div class="generation-label">Gen B</div>';

        // Sibling group 1: Children of 14 & 15
        const gen2SiblingGroup1 = document.createElement("div");
        gen2SiblingGroup1.className = "sibling-group";

        // 4 & 5 (couple)
        const couple2 = document.createElement("div");
        couple2.className = "couple-group";
        couple2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 4))
        );
        couple2.appendChild(
          createPersonCard(familyData.find((p) => p.id === 5))
        );
        const connector2 = document.createElement("div");
        connector2.className = "marriage-connector";
        couple2.appendChild(connector2);
        gen2SiblingGroup1.appendChild(couple2);

        // 16 (single - brother of 4, NOT brother of 5)
        gen2SiblingGroup1.appendChild(
          createPersonCard(familyData.find((p) => p.id === 16))
        );
        gen2Row.appendChild(gen2SiblingGroup1);

        // Sibling group 2: Children of 9 & 10 (5 and 6)
        const gen2SiblingGroup2 = document.createElement("div");
        gen2SiblingGroup2.className = "sibling-group";

        // 6 & 2.2 (couple)
        const couple3 = document.createElement("div");
        couple3.className = "couple-group";
        couple3.appendChild(
          createPersonCard(familyData.find((p) => p.id === 6))
        );
        couple3.appendChild(
          createPersonCard(familyData.find((p) => p.id === 2.2))
        );
        const connector3 = document.createElement("div");
        connector3.className = "marriage-connector";
        couple3.appendChild(connector3);
        gen2SiblingGroup2.appendChild(couple3);

        // Note: 5 is also child of 9 & 10, but shown in couple group with 4
        gen2Row.appendChild(gen2SiblingGroup2);

        container.appendChild(gen2Row);

        // Generation 1 (Bottom row)
        const gen1Row = document.createElement("div");
        gen1Row.className = "generation-row";
        gen1Row.innerHTML = '<div class="generation-label">Gen C</div>';

        // 14 & 15 (couple - parents of 4)
        const couple5 = document.createElement("div");
        couple5.className = "couple-group";
        couple5.appendChild(
          createPersonCard(familyData.find((p) => p.id === 14))
        );
        couple5.appendChild(
          createPersonCard(familyData.find((p) => p.id === 15))
        );
        const connector5 = document.createElement("div");
        connector5.className = "marriage-connector";
        couple5.appendChild(connector5);
        gen1Row.appendChild(couple5);

        // 9 & 10 (couple)
        const couple4 = document.createElement("div");
        couple4.className = "couple-group";
        couple4.appendChild(
          createPersonCard(familyData.find((p) => p.id === 9))
        );
        couple4.appendChild(
          createPersonCard(familyData.find((p) => p.id === 10))
        );
        const connector4 = document.createElement("div");
        connector4.className = "marriage-connector";
        couple4.appendChild(connector4);
        gen1Row.appendChild(couple4);

        // 11 (single)
        gen1Row.appendChild(
          createPersonCard(familyData.find((p) => p.id === 11))
        );

        // 12 (single)
        gen1Row.appendChild(
          createPersonCard(familyData.find((p) => p.id === 12))
        );

        // 13 (single)
        gen1Row.appendChild(
          createPersonCard(familyData.find((p) => p.id === 13))
        );

        container.appendChild(gen1Row);

        // Draw connections immediately
        drawConnections();
      }

      // Search functionality
      document
        .getElementById("searchInput")
        .addEventListener("input", function (e) {
          const searchTerm = e.target.value.toLowerCase();
          const cards = document.querySelectorAll(".person-card");

          cards.forEach((card) => {
            const name = card
              .querySelector(".person-name")
              .textContent.toLowerCase();
            if (name.includes(searchTerm)) {
              card.style.opacity = "1";
              card.style.transform = "scale(1.05)";
            } else {
              card.style.opacity = searchTerm ? "0.3" : "1";
              card.style.transform = "scale(1)";
            }
          });
        });

      // Add pulse animation
      const style = document.createElement("style");
      style.textContent = `
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); box-shadow: 0 0 0 3px rgba(236, 114, 17, 0.4); }
            }
        `;
      document.head.appendChild(style);

      // Initialize tree
      renderTree();
      renderTimeline();

      // Redraw connections on window resize
      window.addEventListener("resize", () => {
        drawConnections();
      });
    </script>
  </body>
</html>
